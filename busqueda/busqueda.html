<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Búsqueda de Cursos - SkillHub</title>
    <link rel="stylesheet" href="busqueda.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>

    <header class="header">
        <div class="container header-container">
            <div class="logo">
                <img class="logo-image" src="http://localhost/PWCI-Repo/Multimedia/LogoPS.png" alt="SkillHub Logo">
                <img class="logo-name" src="http://localhost/PWCI-Repo/Multimedia/LogoNombreS.png" alt="SkillHub">
            </div>
            <nav class="main-nav">
                <ul>
                    <li><a href="http://localhost/PWCI-Repo/Inicio/inicio.html">Inicio</a></li>
                    <li><a href="http://localhost/PWCI-Repo/categorias%20y%20carrito/carritoPWCI.html">Carrito</a></li>
                    <li><a href="http://localhost/PWCI-Repo/categorias%20y%20carrito/categorias.html">Categorías</a></li>
                </ul>
            </nav>

            <div class="search-bar">
                <input type="text" placeholder="Busca aquí...">
                <i class="fa fa-search search-icon"></i>
            </div>

            <?php if (isset($_SESSION['id_usuario'])): ?>
                <div class="user-profile" id="userProfile">
                    <img src="<?php echo isset($avatar_url) ? $avatar_url : '/default-avatar.png'; ?>" alt="Avatar" class="avatar" id="profileMenuToggle">
                    <div class="profile-menu" id="profileMenu">
                        <a href="/PerfilUser/perfilUser.html">Ver Perfil</a>
                        
                        <?php if ($_SESSION['rol_usuario'] == 1): // Estudiante ?>
                            <a href="/MisCursos/perfilEstudiante.html">Ver mis cursos</a>
                        <?php elseif ($_SESSION['rol_usuario'] == 2): // Instructor ?>
                            <a href="/PerfilInstructor/perfilInstructor.html">Ver mis ventas</a>
                        <?php elseif ($_SESSION['rol_usuario'] == 3): // Administrador ?>
                            <a href="/PerfilAdmin/admin.html">Ver reportes</a>
                        <?php endif; ?>
                        
                        <a href="http://localhost/PWCI-Repo/backend/logout.php">Cerrar sesión</a>
                    </div>
                </div>
            <?php else: ?>
                <div class="auth-buttons">
                    <a href="/logIn/logIn.html" class="btn btn-login">Iniciar sesión</a>
                    <a href="/SignIn/signIn.html" class="btn btn-signin">Registrarse</a>
                </div>
            <?php endif; ?>
        </div>
    </header>

    <main>
        <div class="search-container">
            <h2>Buscar Cursos</h2>

            <!-- Formulario de búsqueda -->
            <form action="http://localhost/PWCI-Repo/backend/busqueda.php" method="GET">
                <input type="text" name="q" placeholder="Busca por título" value="<?php echo htmlspecialchars($_GET['q'] ?? ''); ?>">

                <!-- Filtro de categoría -->
                <select name="categoria">
                    <option value="">Seleccionar Categoría</option>
                    <?php foreach ($categoriasResult as $row): ?>
                        <option value="<?php echo $row['ID_Categoria']; ?>" <?php echo ($_GET['categoria'] == $row['ID_Categoria']) ? 'selected' : ''; ?>>
                            <?php echo htmlspecialchars($row['Nombre']); ?>
                        </option>
                    <?php endforeach; ?>
                </select>

                <!-- Filtro de usuario -->
                <select name="usuario">
                    <option value="">Seleccionar Instructor</option>
                    <?php foreach ($usuariosResult as $row): ?>
                        <option value="<?php echo $row['ID_Usuario']; ?>" <?php echo ($_GET['usuario'] == $row['ID_Usuario']) ? 'selected' : ''; ?>>
                            <?php echo htmlspecialchars($row['Nombre']); ?>
                        </option>
                    <?php endforeach; ?>
                </select>

                <!-- Filtro de fechas -->
                <input type="date" name="fecha_inicio" value="<?php echo htmlspecialchars($_GET['fecha_inicio'] ?? ''); ?>">
                <input type="date" name="fecha_fin" value="<?php echo htmlspecialchars($_GET['fecha_fin'] ?? ''); ?>">

                <button type="submit">Buscar</button>
            </form>

            <div class="search-results">
                <?php if (count($cursos) > 0): ?>
                    <?php foreach ($cursos as $curso): ?>
                        <div class="course">
                            <h3><?php echo htmlspecialchars($curso['Titulo']); ?></h3>
                            <p><?php echo htmlspecialchars($curso['Descripcion']); ?></p>
                            <p><strong>Instructor:</strong> <?php echo htmlspecialchars($curso['InstructorNombre']); ?></p>
                            <p><strong>Fecha de creación:</strong> <?php echo htmlspecialchars($curso['Fecha_Creacion']); ?></p>
                        </div>
                    <?php endforeach; ?>
                <?php else: ?>
                    <p>No se encontraron resultados.</p>
                <?php endif; ?>
            </div>
        </div>
    </main>

<footer>
    <!-- Aquí puede ir tu pie de página -->
</footer>

<script src="busqueda.js"></script>

</body>
</html>
